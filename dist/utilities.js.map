{"version":3,"file":"utilities.js","sources":["../snippets/utils.js","../snippets/data.js","../snippets/elements.js"],"sourcesContent":["// @ts-check\n// https://www.freecodecamp.org/news/pipe-and-compose-in-javascript-5b04004ac937/\nexport const pipe =\n\t(/** @type {((arg: any) => any)[]} */ ...fns) =>\n\t(/** @type {unknown} */ x) =>\n\t\tfns.reduce((v, f) => f(v), x);\n\nexport const noop = () => {};\n\n/**\n * Returns the true type of a variable\n *\n * e.g. `{}` returns `Object`, `[]` returns `Array`, and `function(){}` returns `Function`\n * @param {any} obj\n * @returns {string}\n */\nexport const type = (obj) => Object.prototype.toString.call(obj).slice(8, -1);\n\n/**\n * @param {()=>void} fn\n */\nexport const createWorker = (fn) =>\n\tnew Worker(\n\t\tURL.createObjectURL(\n\t\t\tnew Blob(['self.onmessage=' + fn.toString() + ';'], {\n\t\t\t\ttype: 'text/javascript',\n\t\t\t}),\n\t\t),\n\t);\n","// @ts-check\nimport { pipe } from './utils.js';\n\nconst handler = {\n\t/**\n\t * @param {object} target\n\t * @param {string} name\n\t * @returns unknown\n\t */\n\tget(target, name) {\n\t\tif (typeof target[name] != 'undefined') {\n\t\t\tif ('properties' in target === false)\n\t\t\t\treturn Reflect.get(target, name);\n\t\t\tif (target.properties[target[name]])\n\t\t\t\treturn Reflect.get(target, 'properties')[target[name]];\n\t\t}\n\t\tconsole.warn(`No such enumerator: ${name}`);\n\t\treturn false;\n\t},\n\t/**\n\t * Since our Enum is read only, this doesn't let us set any new values\n\t * @param {object} x\n\t * @param {string} key\n\t * @param {unknown} name\n\t */\n\tset(x, key, name) {\n\t\tconsole.warn(\n\t\t\t`Cannot add/update properties on an Enum instance after it is defined - ${key}: ${name}`,\n\t\t);\n\t\treturn false;\n\t},\n};\n\n/**\n *\n * @param {object} enumObject\n * @returns {ProxyHandler<object, handler>}\n */\nexport const Enum = (enumObject) => new Proxy(enumObject, handler);\n\n\n/**\n * #### A storage solution aimed at replacing jQuerys data function.\n * \n * Implementation Note: Elements are stored in a [WeakMap](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap).\n * \n * *This makes sure the data is garbage collected when the node is removed.*\n */\nexport const __Data = {\n\t_storage: new WeakMap(),\n\t/**\n\t * @param {HTMLElement} element \n\t * @param {unknown} key \n\t * @param {object} obj \n\t */\n\tput: function (element, key, obj) {\n\t\tif (!this._storage.has(element)) {\n\t\t\tthis._storage.set(element, new Map());\n\t\t}\n\t\tthis._storage.get(element).set(key, obj);\n\t},\n\t/**\n\t * @param {HTMLElement} element \n\t * @param {unknown} key \n\t */\n\tget: function (element, key) {\n\t\treturn this._storage.get(element).get(key);\n\t},\n\t/**\n\t * @param {HTMLElement} element \n\t * @param {unknown} key \n\t */\n\thas: function (element, key) {\n\t\treturn this._storage.has(element) && this._storage.get(element).has(key);\n\t},\n\t/**\n\t * @param {HTMLElement} element \n\t * @param {unknown} key \n\t */\n\tremove: function (element, key) {\n\t\tvar ret = this._storage.get(element).delete(key);\n\t\tif (this._storage.get(element).size === 0) {\n\t\t\tthis._storage.delete(element);\n\t\t}\n\t\treturn ret;\n\t}\n}\n\n\n/**\n * a non CSPRNG random number generator\n * @param {number} a - the length of the returned id\n * @param {number} b? - the length of the Int8Array\n * @returns {string}\n */\nexport const randid = (a, b = 9) =>\n\tcrypto\n\t\t.getRandomValues(new Int8Array(b))\n\t\t.map(Math.abs)\n\t\t.join('')\n\t\t.substr(0, a);\n\n/**\n * Takes a string of invalid or non-compliant JSON and makes it spec-compliant\n *\n * @param {string} text - Malformed or non-compliant JSON-like string\n * \n * ```json\n * { tokenName: 'something', }\n * ```\n * \n * *Becomes*\n * \n * ```json\n * { \"tokenName\": \"something\" }\n * ```\n *\n */\nexport function JSONRelaxer(text) {\n\t/**\n\t * @param {string} match\n\t * @param {string} p1\n\t * @returns {string}\n\t */\n\tconst quotes = (match, p1) => ': \"' + p1.replace(/:/g, '@colon@') + '\"';\n\n\t/**\n\t * TODO: Swap this from two objects into something that isn't two objects -cw\n\t */\n\tconst regexs = {\n\t\tdoubleQuotes: /:\\s*\"([^\"]*)\"/g,\n\t\tquotes: /:\\s*'([^']*)'/g,\n\t\twrapTokens: /(['\"])?([a-z0-9A-Z_]+)(['\"])?\\s*:/g,\n\t\treplaceColonToken: /@colon@/g,\n\t\tremoveTrailingCommas: /\\,(?=\\s*?[\\}\\]])/g,\n\t};\n\n\tconst replacers = {\n\t\tdoubleQuotes: quotes,\n\t\tquotes,\n\t\twrapTokens: '\"$2\": ',\n\t\treplaceColonToken: ':',\n\t\tremoveTrailingCommas: '',\n\t};\n\n\t/**\n\t *\n\t * @param {string} key\n\t * @returns {(text: string) => string}\n\t */\n\tconst runReplace = (key) => (text) =>\n\t\ttext.replace(regexs[key], replacers[key]);\n\n\t/** @type {string} */\n\t// @ts-ignore\n\tconst relaxedJSON = pipe(\n\t\trunReplace('doubleQuotes'),\n\t\trunReplace('quotes'),\n\t\trunReplace('wrapTokens'),\n\t\trunReplace('replaceColonTokens'),\n\t\trunReplace('removeTrailingCommas'),\n\t)(text);\n\n\treturn relaxedJSON;\n}\n","// @ts-check\nimport { noop } from './utils.js';\n\n/**\n * requestAnimationFrame Closure\n *\n * ```js\n * const addClass = rAFC((el, i, arr) => el.classList.add('array-element', 'array-element--' + i, 'array-element--' + i + '-of-' + arr.length));\n *\n * document.querySelectorAll('.element').forEach(addClass);\n * ```\n * @param {(args: unknown[]) => void} fn\n * @returns {(args: unknown[]) => number}\n */\nexport const rAFC =\n\t(fn) =>\n\t(...args) =>\n\t\trequestAnimationFrame(() => fn(...args));\n\n/**\n * @param {HTMLElement} element\n * @param {string} [prefix]\n */\nexport const getOptionsFromDataset = (element, prefix) => (\n\t(prefix = !!prefix ? prefix + '-' : ''),\n\tObject.assign(\n\t\t{},\n\t\t...Array.from(Object.values(element.attributes), (attr) =>\n\t\t\tattr.name.match('data-' + prefix)\n\t\t\t\t? {\n\t\t\t\t\t\t// key === attribute name after data-, and replace - & the following character with following character uppercase;\n\t\t\t\t\t\t[attr.name\n\t\t\t\t\t\t\t.split('data-' + prefix)[1]\n\t\t\t\t\t\t\t.replace(/-./g, (x) => x.toUpperCase()[1])]:\n\t\t\t\t\t\t\tattr.value,\n\t\t\t\t  }\n\t\t\t\t: false,\n\t\t).filter((v) => v),\n\t)\n);\n\nexport const fixRelOpener = () =>\n\trequestAnimationFrame(() =>\n\t\tdocument\n\t\t\t.querySelectorAll('a[target=_blank]:not([rel*=noopener])')\n\t\t\t.forEach((e) =>\n\t\t\t\te.setAttribute('rel', e.getAttribute('rel') + ' noopener'),\n\t\t\t),\n\t);\n\nexport const rIC =\n\t// @ts-expect-error\n\tself.requestIdleCallback ||\n\t((\n\t\t/** @type {(callbackArguments: { didTimeout: boolean; timeRemaining: (e: undefined) => number; }) => any} */ callback,\n\t\tstart = +new Date(),\n\t) =>\n\t\tsetTimeout(\n\t\t\t/** @param {undefined} l */ (l) =>\n\t\t\t\tcallback({\n\t\t\t\t\tdidTimeout: !1,\n\t\t\t\t\ttimeRemaining: /** @param {undefined} e */ (e) =>\n\t\t\t\t\t\tMath.max(0, 50 - (+new Date() - start)),\n\t\t\t\t}),\n\t\t\t1,\n\t\t));\n\nexport const cIC =\n\t//@ts-expect-error\n\tself.cancelIdleCallback || ((/** @type {number} */ e) => clearTimeout(e));\n\n/**\n * Extend the base Event Object to make your own custom event\n * @param {string} type\n * @param {Event} originalEvent?\n * @param {object} detail?\n * @returns {CustomEvent}\n */\nexport const extendEvent = (type, originalEvent = null, detail = {}) => {\n\tif (originalEvent !== null) Object.assign(detail, { originalEvent });\n\tconst { bubbles, cancelable, composed } = originalEvent || {\n\t\tbubbles: true,\n\t\tcancelable: true,\n\t\tcomposed: true,\n\t};\n\n\treturn new CustomEvent(type, {\n\t\tbubbles,\n\t\tcancelable,\n\t\tcomposed,\n\t\tdetail,\n\t});\n};\n\n/**\n * importing the bottom three will allow you to do a requestAnimationTimeout, but\n * you can also add your own cancelAnimationFrameVariable or cancelAnimationTimeout if\n * you need something custom\n */\n/**\n * cancelAnimationTimeout \"rip cord\"\n *\n * Allows you to cancel an animation from anywhere using this variable;\n */\nexport let cancelAnimationFrameVariable = noop;\n/**\n * @param {(raf: number) => void} requestAnimationTimeoutKey\n * @param {(raf: number) => void} cancelAnimationFrameVariable\n */\nexport const cancelAnimationTimeout = (\n\trequestAnimationTimeoutKey,\n\tcancelAnimationFrameVariable,\n) => (cancelAnimationFrameVariable = requestAnimationTimeoutKey);\n\n/**\n * requestAnimationFrame with the benefits of setTimeout\n * @param {(args: unknown) => undefined} fn\n * @param {number} delay\n * @param {(arg: (raf:number) => void) => void} cancelAnimationTimeout\n */\nexport const requestAnimationTimeout = (fn, delay, cancelAnimationTimeout) => {\n\tconst start = performance.now();\n\tconst loop = () => {\n\t\tconst delta = performance.now() - start;\n\n\t\tif (delta >= delay) {\n\t\t\tfn();\n\t\t\tcancelAnimationTimeout(noop);\n\t\t\treturn;\n\t\t}\n\t\tconst raf = requestAnimationFrame(loop);\n\t\tcancelAnimationTimeout(() => cancelAnimationFrame(raf));\n\t};\n\n\tconst raf = requestAnimationFrame(loop);\n\tcancelAnimationTimeout(() => cancelAnimationFrame(raf));\n};\n"],"names":["pipe","x","reduce","v","f","noop","obj","Object","prototype","toString","call","slice","fn","Worker","URL","createObjectURL","Blob","type","handler","get","target","name","Reflect","properties","console","warn","set","key","enumObject","Proxy","_storage","WeakMap","put","element","this","has","Map","remove","ret","size","a","b","crypto","getRandomValues","Int8Array","map","Math","abs","join","substr","text","quotes","match","p1","replace","regexs","doubleQuotes","wrapTokens","replaceColonToken","removeTrailingCommas","replacers","runReplace","requestAnimationFrame","prefix","assign","Array","from","values","attributes","attr","split","toUpperCase","value","filter","document","querySelectorAll","forEach","e","setAttribute","getAttribute","self","requestIdleCallback","callback","start","Date","setTimeout","l","didTimeout","timeRemaining","max","cancelIdleCallback","clearTimeout","originalEvent","detail","bubbles","cancelable","composed","CustomEvent","requestAnimationTimeoutKey","cancelAnimationFrameVariable","delay","cancelAnimationTimeout","performance","now","raf","loop","cancelAnimationFrame"],"mappings":"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"}